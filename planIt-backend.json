{
    "backend": {
        "framework": "next_app_router",
        "runtime": "nodejs",
        "orm_or_query_layer": "drizzle",
        "scheduler": [],
        "package_manager": "npm",
        "start_scripts": [
            "npm run dev",
            "npm run build",
            "npm start"
        ]
    },
    "database": {
        "provider": "postgres",
        "schema_name": "public",
        "migrations": {
            "tool": "custom_sql",
            "paths": [
                "src/lib/db/sql/001_init.sql",
                "src/lib/db/sql/002_policies.sql",
                "src/lib/db/sql/003_seed_example.sql"
            ]
        },
        "enums": [
            {
                "name": "program_kind",
                "values": [
                    "major",
                    "minor"
                ]
            },
            {
                "name": "course_type",
                "values": [
                    "Major",
                    "Core",
                    "GenEd",
                    "LP",
                    "Elective",
                    "Minor"
                ]
            },
            {
                "name": "course_source",
                "values": [
                    "user",
                    "generator",
                    "transfer",
                    "ap"
                ]
            }
        ],
        "tables": [
            {
                "name": "users",
                "columns": [
                    {
                        "name": "id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": [
                            {
                                "target_table": "auth.users",
                                "target_column": "id",
                                "on_delete": "cascade"
                            }
                        ]
                    },
                    {
                        "name": "full_name",
                        "type": "text",
                        "nullable": true,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "avatar_url",
                        "type": "text",
                        "nullable": true,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "created_at",
                        "type": "timestamptz",
                        "nullable": true,
                        "default": "now()",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    }
                ],
                "constraints": [],
                "indexes": []
            },
            {
                "name": "programs",
                "columns": [
                    {
                        "name": "id",
                        "type": "uuid",
                        "nullable": false,
                        "default": "gen_random_uuid()",
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "kind",
                        "type": "program_kind",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "name",
                        "type": "text",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "department",
                        "type": "text",
                        "nullable": true,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "credits",
                        "type": "int",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "created_at",
                        "type": "timestamptz",
                        "nullable": true,
                        "default": "now()",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    }
                ],
                "constraints": [],
                "indexes": []
            },
            {
                "name": "courses",
                "columns": [
                    {
                        "name": "id",
                        "type": "uuid",
                        "nullable": false,
                        "default": "gen_random_uuid()",
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "code",
                        "type": "text",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [
                            "code"
                        ],
                        "foreign_keys": []
                    },
                    {
                        "name": "title",
                        "type": "text",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "credits",
                        "type": "int",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "type",
                        "type": "course_type",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "program_id",
                        "type": "uuid",
                        "nullable": true,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": [
                            {
                                "target_table": "programs",
                                "target_column": "id",
                                "on_delete": "restrict"
                            }
                        ]
                    }
                ],
                "constraints": [
                    "check (credits > 0)"
                ],
                "indexes": []
            },
            {
                "name": "course_prereqs",
                "columns": [
                    {
                        "name": "course_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": [
                            {
                                "target_table": "courses",
                                "target_column": "id",
                                "on_delete": "cascade"
                            }
                        ]
                    },
                    {
                        "name": "prereq_course_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": [
                            {
                                "target_table": "courses",
                                "target_column": "id",
                                "on_delete": "cascade"
                            }
                        ]
                    }
                ],
                "constraints": [],
                "indexes": []
            },
            {
                "name": "plans",
                "columns": [
                    {
                        "name": "id",
                        "type": "uuid",
                        "nullable": false,
                        "default": "gen_random_uuid()",
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "user_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": [
                            {
                                "target_table": "users",
                                "target_column": "id",
                                "on_delete": "restrict"
                            }
                        ]
                    },
                    {
                        "name": "name",
                        "type": "text",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "start_season",
                        "type": "text",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "start_year",
                        "type": "int",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "end_season",
                        "type": "text",
                        "nullable": true,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "end_year",
                        "type": "int",
                        "nullable": true,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "preferences",
                        "type": "jsonb",
                        "nullable": false,
                        "default": "'{}'::jsonb",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "version",
                        "type": "int",
                        "nullable": false,
                        "default": "1",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "created_at",
                        "type": "timestamptz",
                        "nullable": true,
                        "default": "now()",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "updated_at",
                        "type": "timestamptz",
                        "nullable": true,
                        "default": "now()",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    }
                ],
                "constraints": [],
                "indexes": []
            },
            {
                "name": "plan_semesters",
                "columns": [
                    {
                        "name": "id",
                        "type": "uuid",
                        "nullable": false,
                        "default": "gen_random_uuid()",
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "plan_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": [
                            {
                                "target_table": "plans",
                                "target_column": "id",
                                "on_delete": "cascade"
                            }
                        ]
                    },
                    {
                        "name": "season",
                        "type": "text",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "year",
                        "type": "int",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "position",
                        "type": "int",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "total_credits",
                        "type": "int",
                        "nullable": false,
                        "default": "0",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    }
                ],
                "constraints": [],
                "indexes": []
            },
            {
                "name": "plan_courses",
                "columns": [
                    {
                        "name": "id",
                        "type": "uuid",
                        "nullable": false,
                        "default": "gen_random_uuid()",
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "plan_semester_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [
                            "plan_semester_id,course_id"
                        ],
                        "foreign_keys": [
                            {
                                "target_table": "plan_semesters",
                                "target_column": "id",
                                "on_delete": "cascade"
                            }
                        ]
                    },
                    {
                        "name": "course_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [
                            "plan_semester_id,course_id"
                        ],
                        "foreign_keys": [
                            {
                                "target_table": "courses",
                                "target_column": "id",
                                "on_delete": "restrict"
                            }
                        ]
                    },
                    {
                        "name": "source",
                        "type": "course_source",
                        "nullable": false,
                        "default": "'generator'",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "is_locked",
                        "type": "boolean",
                        "nullable": false,
                        "default": "false",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    }
                ],
                "constraints": [],
                "indexes": []
            },
            {
                "name": "share_links",
                "columns": [
                    {
                        "name": "id",
                        "type": "uuid",
                        "nullable": false,
                        "default": "gen_random_uuid()",
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "plan_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": [
                            {
                                "target_table": "plans",
                                "target_column": "id",
                                "on_delete": "cascade"
                            }
                        ]
                    },
                    {
                        "name": "token",
                        "type": "text",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [
                            "token"
                        ],
                        "foreign_keys": []
                    },
                    {
                        "name": "expires_at",
                        "type": "timestamptz",
                        "nullable": true,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "is_public",
                        "type": "boolean",
                        "nullable": false,
                        "default": "false",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "created_at",
                        "type": "timestamptz",
                        "nullable": true,
                        "default": "now()",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    }
                ],
                "constraints": [],
                "indexes": []
            },
            {
                "name": "request_log",
                "columns": [
                    {
                        "name": "id",
                        "type": "bigserial",
                        "nullable": false,
                        "default": null,
                        "identity": true,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "user_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "kind",
                        "type": "text",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    },
                    {
                        "name": "created_at",
                        "type": "timestamptz",
                        "nullable": true,
                        "default": "now()",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    }
                ],
                "constraints": [],
                "indexes": []
            },
            {
                "name": "user_settings",
                "columns": [
                    {
                        "name": "user_id",
                        "type": "uuid",
                        "nullable": false,
                        "default": null,
                        "identity": false,
                        "primary_key": true,
                        "unique_constraints": [],
                        "foreign_keys": [
                            {
                                "target_table": "users",
                                "target_column": "id",
                                "on_delete": "cascade"
                            }
                        ]
                    },
                    {
                        "name": "prefs",
                        "type": "jsonb",
                        "nullable": false,
                        "default": "'{}'::jsonb",
                        "identity": false,
                        "primary_key": false,
                        "unique_constraints": [],
                        "foreign_keys": []
                    }
                ],
                "constraints": [],
                "indexes": []
            }
        ],
        "views": [],
        "functions": [
            {
                "name": "update_total_credits",
                "definition": "create or replace function update_total_credits() returns trigger as $$\nbegin\n  update plan_semesters ps\n  set total_credits = coalesce((\n    select sum(c.credits)\n    from plan_courses pc\n    join courses c on c.id = pc.course_id\n    where pc.plan_semester_id = ps.id\n  ), 0)\n  where ps.id = coalesce(new.plan_semester_id, old.plan_semester_id);\n  return null;\nend;\n$$ language plpgsql;"
            },
            {
                "name": "can_read_shared_plan",
                "definition": "create or replace function can_read_shared_plan(in_token text)\nreturns uuid\nlanguage plpgsql\nsecurity definer\nas $$\ndeclare\n  result uuid;\nbegin\n  select plan_id into result\n  from share_links\n  where token = in_token\n    and is_public = true\n    and (expires_at is null or expires_at > now());\n  return result;\nend;\n$$;"
            }
        ],
        "triggers": [
            {
                "name": "trg_update_total_credits_ins",
                "table": "plan_courses",
                "definition": "after insert or update or delete on plan_courses for each row execute function update_total_credits();"
            }
        ]
    },
    "policies": [
        {
            "table": "users",
            "rls_enabled": true,
            "policies": [
                {
                    "command": "all",
                    "name": "users_all",
                    "definition_sql": "using (id = auth.uid()) with check (id = auth.uid())"
                }
            ]
        },
        {
            "table": "plans",
            "rls_enabled": true,
            "policies": [
                {
                    "command": "all",
                    "name": "plans_all",
                    "definition_sql": "using (user_id = auth.uid()) with check (user_id = auth.uid())"
                }
            ]
        },
        {
            "table": "plan_semesters",
            "rls_enabled": true,
            "policies": [
                {
                    "command": "all",
                    "name": "plan_semesters_all",
                    "definition_sql": "using (exists (select 1 from plans p where p.id = plan_id and p.user_id = auth.uid())) with check (exists (select 1 from plans p where p.id = plan_id and p.user_id = auth.uid()))"
                }
            ]
        },
        {
            "table": "plan_courses",
            "rls_enabled": true,
            "policies": [
                {
                    "command": "all",
                    "name": "plan_courses_all",
                    "definition_sql": "using (exists (select 1 from plan_semesters s join plans p on p.id = s.plan_id where s.id = plan_semester_id and p.user_id = auth.uid())) with check (exists (select 1 from plan_semesters s join plans p on p.id = s.plan_id where s.id = plan_semester_id and p.user_id = auth.uid()))"
                }
            ]
        },
        {
            "table": "user_settings",
            "rls_enabled": true,
            "policies": [
                {
                    "command": "all",
                    "name": "user_settings_all",
                    "definition_sql": "using (user_id = auth.uid()) with check (user_id = auth.uid())"
                }
            ]
        },
        {
            "table": "share_links",
            "rls_enabled": true,
            "policies": [
                {
                    "command": "select",
                    "name": "share_links_read",
                    "definition_sql": "for select using (is_public = true and (expires_at is null or expires_at > now()))"
                }
            ]
        }
    ],
    "data_access": {
        "clients": [
            {
                "kind": "supabase_browser",
                "file": "src/lib/supabaseClient.ts"
            },
            {
                "kind": "supabase_server",
                "file": "src/lib/supabase/server.ts"
            }
        ],
        "examples": [
            {
                "kind": "insert",
                "file": "src/app/api/plans/route.ts",
                "snippet": "const { data, error } = await supabase.from('plans').insert({user_id: user.id, name: parsed.data.name, start_season: parsed.data.startSeason, start_year: parsed.data.startYear, preferences: parsed.data.preferences}).select('*').single();"
            },
            {
                "kind": "upsert",
                "file": "src/app/api/me/route.ts",
                "snippet": "const { error } = await supabase.from('users').upsert({ id: user.id, full_name: parsed.data.full_name, avatar_url: parsed.data.avatar_url }).select('*');"
            },
            {
                "kind": "upsert",
                "file": "src/app/api/settings/route.ts",
                "snippet": "const { error } = await supabase.from('user_settings').upsert({ user_id: user.id, prefs: parsed.data.prefs });"
            }
        ]
    },
    "domain_types": {
        "program": {
            "file": "src/types/index.ts",
            "shape": "{ id: UUID; name: string; department: string; credits: number; }"
        },
        "program_version": null,
        "course": {
            "file": "src/types/index.ts",
            "shape": "{ id: UUID; code: string; title: string; credits: number; type: CourseType; programId?: UUID | null; prerequisites?: string[]; }"
        },
        "requirement_group": null,
        "requirement_item": null,
        "prerequisite_edge": {
            "file": "src/lib/db/drizzle/schema.ts",
            "shape": "{ courseId: uuid; prereqCourseId: uuid; }"
        }
    },
    "env": {
        "server_only": [
            "SUPABASE_SERVICE_ROLE_KEY",
            "DATABASE_URL"
        ],
        "browser_safe": [
            "NEXT_PUBLIC_SUPABASE_URL",
            "NEXT_PUBLIC_SUPABASE_ANON_KEY"
        ]
    }
}